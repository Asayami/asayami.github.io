<!DOCTYPE html>
<html>
  <head>
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-3NTSMWGK5D"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-3NTSMWGK5D");
    </script>
    <meta charset="UTF-8" />
    <title>Malware Analysis Introduction</title>
    <link
      rel="icon"
      type="image/png"
      href="https://asayami.github.io/favicon.png"
    />
    <link
      rel="stylesheet"
      href="https://asayami.github.io/theme/notebook.css"
    />
    <link rel="stylesheet" href="https://asayami.github.io/theme/theme.css" />
    <script src="https://asayami.github.io/theme/notebook.js"></script>
    <script src="https://asayami.github.io/theme/theme.js"></script>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>
    <meta
      name="description"
      content="Những bài viết, kinh nghiệm của mình về windows và malware"
    />
    <meta
      name="keywords"
      content="Hacking, hack, malware, virus, assembly, windows"
    />
    <meta name="author" content="Asayami Kurashin" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <div id="themeSpace"></div>
    <script>
      loadNavbar();
    </script>

    <img class="mainPicture" src="malware_source/malware_bg.jpg" />
    <div class="paragraph">
      <p>
        Malware (malicious software) là phần mềm độc hại được thiết kế để xâm
        nhập, gây hại hoặc đánh cắp thông tin từ hệ thống máy tính. Các loại
        malware phổ biến bao gồm virus, trojan, ransomware và rootkit. Phân tích
        malware (malware analysis) là quá trình nghiên cứu hành vi, chức năng
        của mã độc nhằm tìm ra cách phòng chống và khắc phục hậu quả.
      </p>
      <p>
        Một trong những tài liệu kinh điển về chủ đề này là Practical Malware
        Analysis của Michael Sikorski và Andrew Honig. Cuốn sách cung cấp kiến
        thức từ cơ bản đến nâng cao về phân tích tĩnh và động, giúp người đọc
        hiểu cách reverse engineering malware, sử dụng các công cụ như IDA Pro,
        OllyDbg và xử lý mã độc trong môi trường an toàn. Đây là tài liệu không
        thể thiếu cho những ai muốn tìm hiểu về malware analysis một cách thực
        tiễn.
      </p>
      <p>
        Mình cũng có note lại một vài điểm quan trọng từ cuốn sách này trong
        series này.<br /><br />
      </p>
      <img
        src="malware_source/book_1.png"
        style="width: 25%"
        class="img-fluid mx-auto d-block responsive_phone"
      />
    </div>
    <div class="paratitle">
      <h2>Static Analysis</h2>
    </div>
    <div class="paragraph">
      <p>
        Bước đầu, mình sẽ sử dụng một số tool như dưới đây để phân tích malware
        trên Windows:
        <br />&emsp;- PEiD: Phần mềm dùng để detect packer của file exe.
        <br />&emsp;- Detect It Easy: Dùng để detect packer, compiler, thông tin
        file exe,... (best). <br />&emsp;- Resource Hacker: Dùng để extract
        resource từ file exe. <br />&emsp;- Dependency Walker: Dùng để xem các
        DLL mà file exe sử dụng. <br />&emsp;- ...
      </p>
      <p>
        Ở bước đầu này bạn đọc cũng cần phải nắm chắc kiến thức về Windows. Bạn
        đọc có thể xem lại ở bài viết trước.
      </p>
    </div>

    <div class="paratitle">
      <h2>IDA Pro</h2>
    </div>
    <div class="paragraph">
      <p>
        IDA Pro là một công cụ dịch ngược (disassembler) và gỡ lỗi (debugger)
        mạnh mẽ, được sử dụng rộng rãi trong phân tích tĩnh và động malware.
      </p>
      <h3>Phân tích tĩnh</h3>
      <p>
        &emsp; - Dịch ngược mã nhị phân: Chuyển mã máy thành mã giả Assembly có
        thể đọc được. <br />&emsp; - Chế độ xem đồ họa (Graph View): Hiển thị
        luồng điều khiển của chương trình dưới dạng biểu đồ giúp phân tích dễ
        dàng hơn. <br />&emsp; - Tạo Pseudocode với Hex-Rays Decompiler: Biến mã
        Assembly thành mã C/C++ dễ hiểu hơn (hỗ trợ x86, x64, ARM, v.v.).
        <br />&emsp; - Gán tên, chú thích và kiểu dữ liệu: Hỗ trợ đặt tên biến,
        hàm, thêm ghi chú để giúp hiểu rõ hơn về mã. <br />&emsp; - Phân tích
        cấu trúc và dữ liệu: Xác định bảng hàm, chuỗi, và các thành phần quan
        trọng trong mã độc.
      </p>
      <h3>Phân tích động</h3>
      <p>
        &emsp; - Gỡ lỗi trong môi trường ảo hóa: Hỗ trợ gỡ lỗi mã nhị phân trên
        máy thật hoặc qua trình giả lập. <br />&emsp; - Gỡ lỗi từ xa: Phân tích
        malware trên hệ thống sandbox mà không cần chạy trực tiếp trên máy của
        người dùng. <br />&emsp; - Breakpoint và Memory Patching: Dừng chương
        trình tại điểm mong muốn và thay đổi bộ nhớ để kiểm tra hành vi.
        <br />&emsp; - Theo dõi API Call và Behavior Analysis: Quan sát cách
        malware tương tác với hệ thống.
      </p>
      <p>
        Với khả năng mạnh mẽ trong cả phân tích tĩnh và động, IDA Pro là công cụ
        không thể thiếu cho các nhà nghiên cứu bảo mật khi điều tra mã độc.
      </p>
      <p>
        Bên cạnh những tính năng chính trên, mình muốn giới thiệu thêm tính năng
        scripting của IDA Pro. Scripting giúp tự động hóa các công việc mà trước
        đó phải làm bằng tay, giúp tiết kiệm thời gian và tăng hiệu quả phân
        tích. Ngôn ngữ hỗ trợ scripting trong IDA Pro là IDAPython và IDC (ngôn
        ngữ riêng được IDA tạo ra).</p>
        <p>Ví dụ, mình có viết một đoạn script Python (
        <a
          href="https://asayami.github.io/hacking/malware/malware_source/ida_script.py"
          >Here</a
        >
        ) để tự động hoá việc kiểm tra các thanh ghi có chứa chuỗi "meow" hay
        không sau khi thực hiện mỗi instruction.
      </p>
    </div>

    <div class="paratitle">
      <h2>Dynamic Analysis</h2>
    </div>
    <div class="paragraph">
      <p>
        Một cách nhanh chóng để thực hiện dynamic analysis là ném mẫu malware
        lên malware sandbox. Một số dịch vụ sandbox phổ biến như Hybrid
        Analysis, Any.Run, Joe Sandbox,...
      </p>
      <p>
        Các nền tảng này thường là trả phí, phân tích malware tương tác cho phép
        chạy và quan sát hành vi của mã độc trong môi trường sandbox. Các công
        cụ này cung cấp phân tích thời gian thực với giao diện trực quan, hỗ trợ
        theo dõi quá trình, mạng, registry và file system, giúp phát hiện và
        điều tra malware nhanh chóng.
      </p>
      <p>
        Đặc biệt các report trả về sẽ được đối chiếu theo framework ATT&CK
        Matrix. Framework này được MITRE phát triển để mô tả các kỹ thuật và
        chiến thuật mà kẻ tấn công sử dụng trong suốt vòng đời của một cuộc tấn
        công mạng.
      </p>
      <img
        src="malware_source/mitre.jpg"
        style="width: 50%"
        class="img-fluid mx-auto d-block responsive_phone"
      />
      <h3>Process-related tools</h3>
      <p>
        &emsp;- Process Hacker 2: bản nâng cấp của task manager, cho phép thao
        tác trực tiếp với process, bộ nhớ,... <br />&emsp;- Process Monitor:
        Dùng để log lại các hoạt động của process về registry, file system,
        network,... với filter mạnh mẽ. <br />&emsp;- Regshot: Dùng để so sánh
        snapshot của registry trước và sau khi chạy một process.
      </p>
      <h3>Network-related tools</h3>
      <p>
        &emsp;- FakeNet-NG (Network): Dùng để giả lập môi trường mạng, hỗ trợ
        giả lập các dịch vụ DNS, HTTP, HTTPS, SMTP, FTP,... và làm giả gói tin
        trả về, tuy nhiên không hỗ trợ TLS.
        <br />&emsp;- Netcat: Dùng để tạo kết nối TCP/UDP, gửi và nhận dữ liệu.
        Bạn đọc có thể xem thêm về Netcat ở bài viết
        <a href="https://asayami.github.io/hacking/malware/malware-2.html"
          >Reverse Shell</a
        >. <br />&emsp;- Wireshark: Dùng để log và phân tích đa dạng gói tin
        mạng. <br />&emsp;- ApateDNS + INetSim: Dùng để giả lập dịch vụ và điều
        hướng DNS, tương tự như FakeNet-NG nhưng đa dạng và khó dùng hơn.
      </p>
      <p>
        Sau khi đã cài đăt các công cụ trên, bạn đọc có thể thực hành với mẫu
        reverse shell đơn giản mà mình có đề cập ở bài viết
        <a href="https://asayami.github.io/hacking/malware/malware-2.html"
          >Reverse Shell</a
        >.
      </p>
    </div>
  </body>
</html>
